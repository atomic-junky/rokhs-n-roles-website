---
//  @ts-ignore
import { sanityClient } from 'sanity:client';
import BlogLayout from '../../layouts/BlogLayout.astro'
import { capitalizeFirstLetter } from '../../utils/helpers';


var { slug } = (Astro.params ?? "")

const baseQuery = `*[_type == "post" && defined(slug) && tags[] match lower("${slug}")] | order(publishedAt desc)`
const postCount = await sanityClient.fetch(`count(${baseQuery})`);
const title = capitalizeFirstLetter(slug)

if (postCount <= 0) {
    Astro.response.status = 404;
    return new Response(null, {
        status: 404,
        statusText: 'Not found'
  });
}
---

<BlogLayout
	title={title}
	postCount={postCount}
	pageTitle={"CatÃ©gorie : " + title}
	baseQuery={baseQuery}
/>